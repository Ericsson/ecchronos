
# Introduction

As any distributed service does, sometimes ecChronos breaks and you will have to troubleshoot what is going on. Generally speaking you can debug ecChronos like any other distributed Java program, meaning that you have to find which instances in your cluster are misbehaving and then isolate the problem using logs and tools. Luckily ecChronos have a set of tools to help the debbuging proccess.

## Find The Misbehaving Instances

The first step to troubleshooting an ecChronos issue is to use error messages, metrics and monitoring information to identify if the issue lies with the clients or the server and if it does lie with the server find the problematic nodes in the Cassandra cluster. The goal is to determine if this is a system issue (e.g. a problem pattern that affects the entire cluster) or isolated to a subset of instances (e.g. neighbors holding a lock or even a single node with faulty hardware).

## Client Logs and Errors

During repair operations in a cassandra instance, triggered by ecChronos, it can return erros logs, like below:

|Error                                                                   | Possible cause                                                                                     |
|------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
|"Unexpected interrupt while trying to connect to Cassandra"             | Cassandra Node Overloaded, Bad Configuration on Installing, ecChronos Tables does not exists, etc. |
|"Unable to register watch service, configuration refresh will not work" | Path Directory does not exists, File Permission disagred with request, etc.                        |
|"Unable to get maxRepaired for {<table_reference>}"                     | Cassandra Node Overloaded, Instance Not Found, Table does not Exists Anymore, etc.                 |

*Furthermore, one common problem is when repair is taking too much time or is overdue. This can be caused by too many vnodes, nodes going down while holding a lock and Cassandra nodes being down.*

## Metrics

If you have Cassandra metrics reporting to a centralized location such as Graphite or Grafana you can typically use those to narrow down the problem. Also, ecChronos can be monitored, as described in the [repair monitoring documentation](REPAIR_MONITORING.md). Using metrics, it is possible to identify problems in the cluster and evaluate some basic things, like overload, network issues, cassandra rejections, etc.

## Use ECCTOOL

ecctool is a command line utility which can be used to perform actions toward a local ecChronos instance. The actions are implemented in the form of subcommands with arguments. All visualization is displayed in form of human-readable tables.

To have more information about ecctool you can check the [ecctool examples](ECCTOOL_EXAMPLES.md) and [ecctool documentation](autogenerated/ECCTOOL.md)

## Cassandra Troubleshooting

As ecChronos is a client that sends requests to Cassandra to carry out repairs and sometimes it may happen that the Cassandra node does not respond for some reason. So Cassandra itself have guides to troubleshoot an issue which can be found in the [Cassandra Troubleshooting Documentation](https://cassandra.apache.org/doc/latest/cassandra/troubleshooting/index.html).

## Report a Bug

If using the tools and performing debugging was not enough to determine the root cause of the problem consider opening an ISSUE to ecChronos team investigate and provide support, for that, you can check the [Contributing Guide](CONTRIBUTING.md).

Also, before opening an ISSUE, gather log files, metrics, tests carried out and open the ticket with the following format:

```markdown
Title: A concise and descriptive summary of the Problem

Description:

It is important to contextualize the problem. Therefore, it describes the current system's behavior and its proposed correction. Additionally, it should describe ecChronos version and system configuration (Virtualized or Container) if the author has this information. This is to avoid asking the author basic questions that could have been avoided by providing more detailed information in the user story.

Give us a description that can answer these questions:

1- Does the problem persist?
2- Describe how to reproduce the issue, if possible. If not, describe why.

Detailed description:
• What is happening?
• What did you expect to happen?
• What have you tried?
• What version of ecChronos are you using?
• Was the problem detected during an upgrade or downgrade procedure?
• Have you checked the ecChronos documents?
• What do YOU think is the issue (optional)?
• Anything else that is worth being noted (optional)?
```

Always attach log files and command results. Otherwise, it will not be possible to investigate the problem accurately.
